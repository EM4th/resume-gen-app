<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Resume Generator - Transform Your Career</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=3.0">
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7524647518323966" crossorigin="anonymous"></script>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-7524647518323966",
            enable_page_level_ads: true
        });
    </script>
</head>
<body>
    <!-- Header Ad -->
    <div class="header-ad">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-7524647518323966"
             data-ad-slot="auto"
             data-ad-format="horizontal"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <div class="container">
        <header>
            <h1>üöÄ AI Resume Generator</h1>
            <p class="subtitle">Transform your resume with AI to match any job description perfectly</p>
        </header>

        <main class="main-content">
            <!-- Upload Form -->
            <div class="upload-section" id="uploadSection">
                <form id="resumeForm" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="resume">Upload Your Resume (PDF):</label>
                        <input type="file" id="resume" name="resume_file" accept=".pdf" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="jobDescription">Job Description (URL or Text):</label>
                        <textarea id="jobDescription" name="job_description" 
                                  placeholder="Paste job description text or enter a job posting URL..." 
                                  rows="6" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="format">Output Format:</label>
                        <select id="format" name="format">
                            <option value="pdf">PDF</option>
                            <option value="docx">DOCX</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="generate-btn" id="generateBtn">
                        üéØ Generate Enhanced Resume
                    </button>
                </form>
            </div>

            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="loading">
                <div class="spinner"></div>
                <p>ü§ñ AI is enhancing your resume...</p>
            </div>

            <!-- Sidebar Ad -->
            <div class="sidebar-ad">
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-7524647518323966"
                     data-ad-slot="auto"
                     data-ad-format="rectangle"
                     data-full-width-responsive="true"></ins>
                <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>

            <!-- Success View -->
            <div id="successContainer" class="success-container">
                <h2 class="success-title">üéâ Your Resume is Ready!</h2>
                <p class="success-message">Your AI-enhanced resume has been generated successfully!</p>
                
                <!-- Success Ads -->
                <div class="success-ad">
                    <ins class="adsbygoogle"
                         style="display:block"
                         data-ad-client="ca-pub-7524647518323966"
                         data-ad-slot="auto"
                         data-ad-format="rectangle"
                         data-full-width-responsive="true"></ins>
                    <script>
                         (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                </div>

                <!-- Action Grid -->
                <div class="action-grid">
                    <div class="action-card" onclick="createNewResume()">
                        <h4>üìÑ New Resume</h4>
                        <p>Create another resume</p>
                        <button class="action-btn">Start Fresh</button>
                    </div>
                    
                    <div class="action-card" onclick="window.open('#', '_blank')">
                        <h4>üìù Cover Letter</h4>
                        <p>Generate matching cover letter</p>
                        <button class="action-btn">Create Letter</button>
                    </div>
                    
                    <div class="action-card" onclick="window.open('#', '_blank')">
                        <h4>üíº Job Tips</h4>
                        <p>Get interview preparation tips</p>
                        <button class="action-btn">Get Tips</button>
                    </div>
                </div>

                <!-- Bottom Success Ad -->
                <div class="success-ad-bottom">
                    <ins class="adsbygoogle"
                         style="display:block"
                         data-ad-client="ca-pub-7524647518323966"
                         data-ad-slot="auto"
                         data-ad-format="horizontal"
                         data-full-width-responsive="true"></ins>
                    <script>
                         (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer Ad -->
    <div class="footer-ad">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-7524647518323966"
             data-ad-slot="auto"
             data-ad-format="horizontal"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <script>
        // Form submission handler
        document.getElementById('resumeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const generateBtn = document.getElementById('generateBtn');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const uploadSection = document.getElementById('uploadSection');
            
            // Show loading state
            generateBtn.disabled = true;
            generateBtn.textContent = 'Processing...';
            loadingIndicator.style.display = 'block';
            
            // Submit form
            fetch('/generate_resume', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    // Hide loading and show success after 3 seconds
                    setTimeout(() => {
                        loadingIndicator.style.display = 'none';
                        showSuccessView();
                        
                        // Refresh ads
                        try {
                            (adsbygoogle = window.adsbygoogle || []).push({});
                        } catch (e) {
                            console.log('AdSense refresh skipped');
                        }
                    }, 3000);
                } else {
                    throw new Error(data.error || 'Unknown error occurred');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                loadingIndicator.style.display = 'none';
                generateBtn.disabled = false;
                generateBtn.textContent = 'üéØ Generate Enhanced Resume';
                
                // Better error message
                let errorMsg = 'Failed to process resume. ';
                if (error.message.includes('Failed to fetch')) {
                    errorMsg += 'Please check your internet connection and try again.';
                } else if (error.message.includes('HTTP error')) {
                    errorMsg += 'Server error. Please try again later.';
                } else {
                    errorMsg += error.message;
                }
                alert('Error: ' + errorMsg);
            });
        });

        function showSuccessView() {
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('successContainer').style.display = 'block';
        }

        function createNewResume() {
            document.getElementById('successContainer').style.display = 'none';
            document.getElementById('uploadSection').style.display = 'block';
            document.getElementById('resumeForm').reset();
            document.getElementById('generateBtn').disabled = false;
            document.getElementById('generateBtn').textContent = 'üéØ Generate Enhanced Resume';
        }
    </script>
</body>
</html>
